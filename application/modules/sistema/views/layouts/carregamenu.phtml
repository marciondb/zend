
<?php
    /* * *
    * Carrega o menu baseado nas permissoes do usuario
    */

    $_SESSION['menu'] = null;
    unset($_SESSION['menu']);

?>

<p align="right"><?php echo $this->nome_usuario; ?> | <a href="<?php echo $this->url(array('module' => 'sistema', 'controller' => 'index', 'action' => 'logout'), null, 1); ?>">sair</a></p>

<?php
    $_SESSION['menu'] = '';
    $_SESSION['menu'] .= '<ul id="nav">'."\n".'
                <li class="current"><a href="'.$this->url(array('module' => 'sistema', 'controller' => 'logado', 'action' => 'index'), null, 1).'">Home</a></li>'."\n";
    
    function montaMenu($id_funcionalidade,$resultado,$url)
    {
        foreach ($resultado as $value) 
        {
            
            if ($value['id_funcionalidade_pai']==$id_funcionalidade)
            {
                
                if($value['action']=='')
                {
                    $_SESSION['menu'] .= "<li><a href='#'>".$value['titulo']."</a>\n";
                        $_SESSION['menu'] .=  "<ul>\n";
                }
                else
                {                    
                    $_SESSION['menu'] .= "<li><a href='".$url.$value['action']."'>".$value['titulo']."</a></li>\n";
                }
                
                //echo $value['titulo']." ".$value['action']."\n";
                
                montaMenu($value['id_funcionalidade'],$resultado,$url);//,$menu);
                
                if($value['action']=='')
                {
                    $_SESSION['menu'] .= "</ul>\n";
                    $_SESSION['menu'] .= "</li>\n";
                }
            }
        }
        
    }
    
    montaMenu(0,$this->permissoes,$this->url(array('module' => 'sistema', 'controller' => 'logado', 'action' => ''), null, 1));
    
    $_SESSION['menu'] .= '</ul>';
    
    
    echo $_SESSION['menu'];
    
    $_SESSION['menu'] = null;
    unset($_SESSION['menu']);
 